<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Engativá Inspira</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="admin-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="admin-body">

    <nav class="admin-sidebar">
        <h2><i class="fas fa-user-shield"></i> Admin Panel</h2>
        <hr style="border: 0.5px solid var(--bg-h); margin-bottom: 20px;">
        
        <div class="admin-nav-item active" onclick="mostrarSeccion('dashboard')">
            <i class="fas fa-chart-line"></i> Dashboard
        </div>
        <div class="admin-nav-item" onclick="mostrarSeccion('productos')">
            <i class="fas fa-box"></i> Gestión de Productos
        </div>
        <div class="admin-nav-item" onclick="mostrarSeccion('vendedores')">
            <i class="fas fa-store"></i> Vendedores
        </div>
        <div class="admin-nav-item" onclick="mostrarSeccion('configuracion')">
            <i class="fas fa-cog"></i> Configuración
        </div>
        
        <div class="admin-nav-item" style="margin-top: auto; color: #ff4d4d;" onclick="location.href='index.html'">
            <i class="fas fa-sign-out-alt"></i> Salir al Sitio
        </div>
    </nav>

    <main class="admin-main">
        
        <section id="sec-dashboard" class="admin-section">
            <h2 class="section-title">Resumen del Sistema</h2>
            <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="admin-card">
                    <h4>Total Productos</h4>
                    <p id="stat-total-productos" style="font-size: 2rem; color: var(--azul);">0</p>
                </div>
                <div class="admin-card">
                    <h4>Top Clics WhatsApp</h4>
                    <p id="stat-top-clicks" style="font-size: 2rem; color: var(--verde);">0</p>
                </div>
            </div>

            <div class="admin-card">
                <h3><i class="fas fa-fire"></i> Productos más consumidos (Top 5)</h3>
                <table id="tabla-top-productos">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Vendedor</th>
                            <th>Vistas</th>
                        </tr>
                    </thead>
                    <tbody id="lista-top-vistas">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="sec-productos" class="admin-section" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 class="section-title">Gestión de Productos</h2>
                <button class="btn-save" onclick="abrirModalCarga()"><i class="fas fa-plus"></i> Nuevo Producto</button>
            </div>

            <div class="admin-card">
                <table id="tabla-productos-general">
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Vendedor</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpo-tabla-productos">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="sec-configuracion" class="admin-section" style="display: none;">
            <h2 class="section-title">Configuración General</h2>
            <div class="admin-card">
                <h3>Control de Botón de WhatsApp</h3>
                <div class="form-group">
                    <label>Número Central de Contacto (Ej: 573001234567)</label>
                    <input type="text" id="cfg-whatsapp" placeholder="Ingrese el número">
                </div>
                <button class="btn-save" onclick="guardarConfiguracion()">Guardar Cambios</button>
            </div>
        </section>

    </main>

    <div id="modal-admin-producto" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 700px; border-radius: 12px; overflow: hidden; padding: 0; display: flex; flex-direction: column; max-height: 90vh;">
            <div style="background: var(--bg-h); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                <h3 style="margin: 0; color: var(--azul);"><i class="fas fa-box"></i> Nuevo Producto</h3>
                <span class="close-modal" onclick="cerrarModalAdmin()" style="position: static; margin: 0;">&times;</span>
            </div>
            
            <form id="form-producto-admin" class="custom-scroll" style="padding: 25px; overflow-y: auto;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Columna Izquierda -->
                    <div>
                        <div class="form-group">
                            <label>Nombre del Producto</label>
                            <input type="text" id="p-nombre" required placeholder="Ej: Bicicleta Todoterreno">
                        </div>
                        <div class="form-group">
                            <label>Precio</label>
                            <input type="text" id="p-precio" placeholder="$ 0.000" required>
                        </div>
                        <div class="form-group">
                            <label>Localidad</label>
                            <select id="p-localidad" required style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--bg-h); background: var(--bg-p); color: var(--txt-p);">
                                <option value="">Seleccione...</option>
                                <option value="Engativá">Engativá</option>
                                <option value="Suba">Suba</option>
                                <option value="Teusaquillo">Teusaquillo</option>
                                <option value="Usaquén">Usaquén</option>
                                <option value="Chapinero">Chapinero</option>
                                <option value="Barrios Unidos">Barrios Unidos</option>
                                <option value="Kennedy">Kennedy</option>
                                <option value="Fontibón">Fontibón</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Vendedor</label>
                            <input type="text" id="p-vendedor" placeholder="Nombre del vendedor o tienda" required>
                        </div>
                    </div>

                    <!-- Columna Derecha -->
                    <div>
                        <div class="form-group">
                            <label>Teléfono (WhatsApp)</label>
                            <input type="text" id="p-telefono" placeholder="Ej: 573001234567" required>
                        </div>
                        <div class="form-group">
                            <label>Dirección / Punto de Encuentro</label>
                            <input type="text" id="p-direccion" placeholder="Ej: C.C. Titán Plaza">
                        </div>
                        <div class="form-group">
                            <label>Imagen del Producto</label>
                            <div style="border: 2px dashed var(--bg-h); padding: 15px; text-align: center; border-radius: 8px; cursor: pointer; position: relative;" onclick="document.getElementById('p-img-file').click()">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 24px; color: var(--azul);"></i>
                                <p style="margin: 5px 0; font-size: 12px; color: var(--txt-s);">Click para subir imagen</p>
                                <input type="file" id="p-img-file" accept="image/*" style="display: none;" onchange="if(this.files[0]) this.previousElementSibling.innerText = this.files[0].name">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 15px;">
                    <label>Descripción</label>
                    <textarea id="p-desc" rows="3" placeholder="Detalles del estado, características, etc."></textarea>
                </div>

                <div style="margin-top: 20px; text-align: right; display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" onclick="cerrarModalAdmin()" style="background: transparent; border: 1px solid var(--bg-h); color: var(--txt-p); padding: 10px 20px; border-radius: 6px; cursor: pointer;">Cancelar</button>
                    <button type="submit" class="btn-save" style="width: auto; padding: 10px 30px;"><i class="fas fa-save"></i> Publicar Producto</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script src="firebase-config.js"></script>
    <script src="admin-logic.js"></script>

    <script>
        // Función simple para cambiar entre pestañas del admin
        function mostrarSeccion(id) {
            document.querySelectorAll('.admin-section').forEach(s => s.style.display = 'none');
            document.querySelectorAll('.admin-nav-item').forEach(i => i.classList.remove('active'));
            
            document.getElementById('sec-' + id).style.display = 'block';
            event.currentTarget.classList.add('active');
        }

        function abrirModalCarga() { document.getElementById('modal-admin-producto').style.display = 'flex'; }
        function cerrarModalAdmin() { document.getElementById('modal-admin-producto').style.display = 'none'; }
    </script>
    <script src="script.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="firebase-config.js"></script>
</body>
</html>